// Generated by CoffeeScript 1.6.3
var num = 1;
(function() {
  $(function() {
//	var brick;
//	brick = "<div class='brick large'><a class='edit' href='javascript:;'>编辑</a><a class='delete' href='javascript:;'>移除</a><div name='content'>1</div></div>";
//	sbrick = "<div class='brick small'><a class='edit' href='javascript:;'>编辑</a><a class='delete' href='javascript:;'>移除</a><div name='content'>2</div></div>";

//	$(document).on("click", ".gridly .del", function(event) {
//		var $this;
//		event.preventDefault();
//		event.stopPropagation();
//		$this = $(this);
//		$this.closest('.brick').remove();
//		return $('.gridly').gridly('layout');
//	});

//	$(document).on("click", ".gridly .edit", function(event) {
//		var $this;
//		event.preventDefault();
//		event.stopPropagation();
//		$this = $(this);
//		var contentId = $(this).parent().find("input").val();
//		$("#contentId").val(contentId);
//		showDiv();
//		var html = $("#"+contentId).html();
////		var html = decodeURI($("#templateContent").val());
//		html = html.replaceAll('<xmp>', '');
//		html = html.replaceAll('</xmp>', '');
//		$("#editModulecontent").val("");
//		$("#editModulecontent").val(html);
//	});
	$(document).on("click", ".get", function(event) {
		event.preventDefault();
		event.stopPropagation();
		var html = $('.example').html();
		html = html.replaceAll('<a class="edit" href="javascript:;">编辑</a>', '');
		html = html.replaceAll('<a class="del" href="javascript:;">移除</a>', "");
		showDiv();
		editor.html(html);
//		return $('.gridly').gridly();
	});
	return $('.gridly').gridly();
  });
}).call(this);

function showDiv(){
	document.getElementById('popDiv').style.display='block';
	document.getElementById('popIframe').style.display='block';
	document.getElementById('bg').style.display='block';
}
function closeDiv(){
	document.getElementById('popDiv').style.display='none';
	document.getElementById('bg').style.display='none';
	document.getElementById('popIframe').style.display='none';
}

function getTempHtml(){
	event.preventDefault();
	event.stopPropagation();
	var html = $('.example').html();
	html = html.replaceAll('<a class="edit" href="javascript:;">编辑</a>', '');
	html = html.replaceAll('<a class="del" href="javascript:;">移除</a>', "");
	showDiv();
	//editor.html(html);
	return html;
}

function saveModuleContent(){
	var contentId =  $("#contentId").val();
	var html = $("#editModulecontent").val();
//	$("#"+contentId).html("<textarea class='tempArea'>"+html+"</textarea>");
	$("#"+contentId).find("textarea")[0].innerHTML = html;
	
}
function editTemplate(obj) {
		var $this;
		//event.preventDefault();
		//event.stopPropagation();
		$this = $(obj);
		var pId = $this.parent()[0].id;
		$("#contentId").val(pId);
		showDiv();
		var html = $this.parent().find("textarea")[0].innerHTML;
		html = html.replaceAll('<textarea class="tempArea">', '');
		html = html.replaceAll("<textarea class='tempArea'>", '');
		html = html.replaceAll('<TEXTAREA class=tempArea>', '');
		html = html.replaceAll('<textarea class="tempSmallArea">', '');
		html = html.replaceAll("<textarea class='tempSmallArea'>", '');
		html = html.replaceAll('<TEXTAREA class=tempSmallArea>', '');
		html = html.replaceAll('</TEXTAREA>', '');
		html = html.replaceAll('</textarea>', '');
		html = html.replaceAll("&amp;", '&');
		html = html.replaceAll("&lt;", '<');
		html = html.replaceAll("&gt;", '>');
		$("#editModulecontent").val("");
		$("#editModulecontent").val(html);
}

function deleteGridly(obj) {
	var $this;
	//event.preventDefault();
	//event.stopPropagation();
	$this = $(obj);
//	$this = obj;
	$this.closest('.brick').remove();
	return $('.gridly').gridly('layout');
}
function addLargeModule(id) {
	
	var templateWidth = Ext.getCmp('channelTemplate.width').getValue();
	
	if(null == templateWidth || templateWidth.length==0){
	
		alertMsg("验证", "请输入模板宽度！");
		return;
	}
	
	 var reg = new RegExp("^[0-9]*$"); 
	 if(!reg.test(templateWidth)){  

		alertMsg("验证", "模板宽度请输入数字！");
	    return;
	 }  
	
	
	//	$(".gridly").width(templateWidth);
		 
	
	// $(".gridly").width(templateWidth);
	
	var url = basePath + 'custom/channelTemplate/moduleContent.spmvc?id='+id;
	jQuery.ajax({
		url : url,
		type : 'POST',
		//data : queryString,
		success : function(data) {
			var module = eval("("+data+")");
			if (null != module) {
				var time = new Date().Format("yyyy-MM-dd hh:mm:ss");
				time = time.replaceAll(" ","");
				time = time.replaceAll(":","");
				time = time.replaceAll("-","");
				var brick = 
					
				//"<div class='brick large' id='"+time+"_"+module.id+"' style='border:1px #ddd solid;width: "+templateWidth+"px ;height: 150px;background: #FFFFFF; float:left;'>\n"
					
					"<div class='brick large' id='"+time+"_"+module.id+"' >\n"
					
					+ "<a class='editTemplate' href='javascript:;' onclick='editTemplate(this)'>编辑</a>"
					+ "<a class='delTemplate' href='javascript:;' onclick='deleteGridly(this)'>移除</a>"
					//+ "<div id='"+time+"'>"
					+ "<textarea class='tempArea'>" + module.moduleContent +"</textarea>\n"
					//+ "<xmp>" + module.moduleContent +"</xmp>\n"
					//	+ "</div>\n"
						//+ "<input type='hidden' name='temp_num' value='content_"+num+"' />\n"
					+ "</div>\n";
				$('.gridly').append(brick);
				num ++;
				$('.gridly').gridly();
			}
		},
		error : function() {
			alert("occur error");
		}
	});
};
	
function addSmallModule(id) {

	var templateWidth = Ext.getCmp('channelTemplate.width').getValue();
	
	if(null == templateWidth || templateWidth.length==0){
	
		alertMsg("验证", "请输入模板宽度！");
		return;
	}
	
	 var reg = new RegExp("^[0-9]*$"); 
	 if(!reg.test(templateWidth)){  
	
		alertMsg("验证", "模板宽度请输入数字！");
	    return;
	 }  
	
	//	$(".gridly").width(templateWidth);
		 
	
	// $(".gridly").width(templateWidth);
	
	var url = basePath + 'custom/channelTemplate/moduleContent.spmvc?id='+id;
	jQuery.ajax({
		url : url,
		type : 'POST',
		//data : queryString,
		success : function(data) {
			var module = eval("("+data+")");
			if (null != module) {
				var sbrick = 
			//	"<div class='brick small' id='"+module.moduleType+'_'+module.moduleSize+'_'+module.id+"' style='width: "+templateWidth+"px ;height: 150px;background: #FFFFFF;float:left;'>\n"
					"<div class='brick small' id='"+module.moduleType+'_'+module.moduleSize+'_'+module.id+"' >\n"
					+ "<a class='editTemplate' href='javascript:;' onclick='editTemplate(this)'>编辑</a>\n"
					+ "<a class='delTemplate' href='javascript:;' onclick='deleteGridly(this)'>移除</a>\n"
					+ "<div id='"+module.moduleSize+'_'+module.moduleType+'_'+module.id+"'>"
					+ "<textarea class='tempSmallArea'>" + module.moduleContent +"</textarea>\n"
					//	+ "<xmp>" +module.moduleContent+"</xmp>\n"
					+ "</div>\n"
					//+ "<input type='hidden' name='temp_num' value='content_"+num+"' />\n"
				+"</div>\n";
				$('.gridly').append(sbrick);
				num ++;
				$('.gridly').gridly();
			}
		},
		error : function() {
			alert("occur error");
		}
	});
};
String.prototype.replaceAll = function(reallyDo, replaceWith, ignoreCase) {
	if (!RegExp.prototype.isPrototypeOf(reallyDo)) {
		return this.replace(new RegExp(reallyDo, (ignoreCase ? "gi": "g")), replaceWith);
	} else {
		return this.replace(reallyDo, replaceWith);
	}
};


//验证添加模板的宽度不能为空，只能为数字
function validationWidth(val){
	
	var reg = new RegExp("^[0-9]*$"); 
	
	if(null == val || val.length==0){
	//	alertMsg("验证", "请输入模板宽度！");
		return "请输入模板宽度！";
	}else if(!reg.test(val)){  
	//	alertMsg("验证", "模板宽度请输入数字！");
	    return "模板宽度请输入数字！";
	}  else {		
		return "";
	} 
		
}


